import { h, createState } from 'skara-js';

export function TodoList() {
  const todos = createState([
    { id: 1, text: 'Learn Skara.js', completed: false },
    { id: 2, text: 'Build amazing apps', completed: false }
  ]);
  const newTodo = createState('');

  const addTodo = () => {
    const text = newTodo.get().trim();
    if (text) {
      const newId = Math.max(...todos.get().map(t => t.id), 0) + 1;
      todos.set([...todos.get(), { id: newId, text, completed: false }]);
      newTodo.set('');
    }
  };

  const toggleTodo = (id) => {
    todos.set(todos.get().map(todo => 
      todo.id === id ? { ...todo, completed: !todo.completed } : todo
    ));
  };

  const deleteTodo = (id) => {
    todos.set(todos.get().filter(todo => todo.id !== id));
  };

  const handleKeyPress = (e) => {
    if (e.key === 'Enter') addTodo();
  };

  return h('div', { className: 'todo-list' },
    h('h2', null, 'Todo List'),
    h('div', { className: 'todo-input' },
      h('input', {
        type: 'text',
        placeholder: 'Add a new task...',
        value: newTodo.get(),
        onInput: (e) => newTodo.set(e.target.value),
        onKeyPress: handleKeyPress
      }),
      h('button', { onClick: addTodo, className: 'add-btn' }, 'Add')
    ),
    // Make the list reactive by wrapping it in a function
    () => h('ul', { className: 'todo-items' },
      ...todos.get().map(todo =>
        h('li', { 
          key: todo.id, 
          className: `todo-item ${todo.completed ? 'completed' : ''}` 
        },
          h('input', {
            type: 'checkbox',
            checked: todo.completed,
            onChange: () => toggleTodo(todo.id)
          }),
          h('span', { className: 'todo-text' }, todo.text),
          h('button', { 
            onClick: () => deleteTodo(todo.id),
            className: 'delete-btn'
          }, 'Ã—')
        )
      )
    )
  );
}
